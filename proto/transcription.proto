syntax = "proto3";
package AiService;

service Transcription {
	rpc TranscriptionBiStreams (stream DiscordOpusPacketList) returns (stream TranscriptionEvent);
	rpc KeywordSpotting (stream KeywordSpottingRequest) returns (stream KeywordSpottingFound);
}

message DiscordOpusPacket {
	int64 timestamp = 1;
	bytes data = 2;
}

message DiscordOpusPacketList {
	repeated DiscordOpusPacket packets = 1;
	string speaker_id = 2;
	string prompt = 3;
	bool is_final = 4;
}

message TranscriptionEvent {
	string eventName = 1;
	string eventData = 2;
	bytes opusData = 3;
}

message KeywordSpottingRequestConfig {
	repeated string keyword = 1;
}

message KeywordSpottingRequestAudio {
	bytes data = 1;
	string speaker_id = 2;	
}

message KeywordSpottingRequest {
	oneof request_oneof {
		KeywordSpottingRequestConfig config = 1;
		KeywordSpottingRequestAudio audio = 2;
	}
}

message KeywordSpottingFound {
	string keyword = 1;
	float probability = 2;
	string speaker_id = 3;	
}

message KeywordSpottingResponse {
	repeated KeywordSpottingFound found = 1;
}

